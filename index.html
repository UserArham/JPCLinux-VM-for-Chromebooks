<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>v86 Multi-OS Browser VM</title>
<style>
body {
    background: #008080;
    font-family: "Tahoma", sans-serif;
    text-align: center;
    color: white;
    margin: 0;
    padding: 0;
}
header {
    background: #000080;
    color: white;
    padding: 10px;
    font-size: 24px;
    font-weight: bold;
}
button {
    background: #C0C0C0;
    border: 2px solid #808080;
    padding: 8px 16px;
    margin: 10px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 2px 2px #404040;
}
button:hover {
    background: #E0E0E0;
}
#screen {
    width: 800px;
    height: 600px;
    margin: 20px auto;
    border: 4px solid #808080;
    box-shadow: 4px 4px #404040;
    background: black;
}
</style>
</head>
<body>

<header>v86 Multi-OS Browser VM</header>

<p>Select an OS:</p>
<button onclick="startVM('dos')">DOS</button>
<button onclick="startVM('freedos')">FreeDOS</button>
<button onclick="startVM('win98')">Windows 98</button>
<button onclick="startVM('linux')">Linux</button>
<button onclick="resetVM()">Reset VM</button>

<div id="screen"></div>

<script src="https://copy.sh/v86/build/libv86.js"></script>

<script>
let emulator = null;

const OS_IMAGES = {
    dos: {
        cdrom: "https://copy.sh/v86/images/dos.iso",
        memory: 16 * 1024 * 1024
    },
    freedos: {
        cdrom: "https://copy.sh/v86/images/freedos.iso",
        memory: 16 * 1024 * 1024
    },
    win98: {
        cdrom: "https://copy.sh/v86/images/windows98.iso",
        memory: 128 * 1024 * 1024  // increased memory
    },
    linux: {
        cdrom: "https://copy.sh/v86/images/linux.iso",
        memory: 128 * 1024 * 1024  // increased memory
    }
};

function startVM(os) {
    if (emulator) return;

    const config = OS_IMAGES[os];
    emulator = new V86Starter({
        wasm_path: "https://copy.sh/v86/build/v86.wasm",
        memory_size: config.memory,
        screen_container: document.getElementById("screen"),
        bios: { url: "https://copy.sh/v86/bios/seabios.bin" },
        vga_bios: { url: "https://copy.sh/v86/bios/vgabios.bin" },
        cdrom: { url: config.cdrom },
        autostart: true
    });

    emulator.add_listener("serial0-output-char", function(char) {
        console.log("Serial output:", char);
    });

    emulator.add_listener("emulator-ready", function() {
        console.log("Emulator ready");
    });

    emulator.add_listener("emulator-error", function(e) {
        console.error("Emulator error:", e);
    });
}

function resetVM() {
    if (emulator) {
        emulator.stop();
        emulator = null;
    }
    const container = document.getElementById("screen");
    container.innerHTML = ""; // Clear canvas and children
    container.style.background = "black";
}
</script>

</body>
</html>
